// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- ENUMS ---

enum UserRole {
  Master
  Vendor
}

enum ProductType {
  rooftop
  pump
  Contact_Inquiry
}

enum PipelineStage {
  New_Lead
  Verified_Lead
  Qualified
  Site_Survey_Scheduled
  Proposal_Sent
  Negotiation
  Closed_Won
  Closed_Lost
}

enum LeadScoreStatus {
  Hot
  Warm
  Cold
}


// --- MODELS ---

model User {
  id           String    @id @default(cuid())
  email        String    @unique
  name         String
  password     String
  role         UserRole  @default(Vendor)
  country      String?
  state        String?
  district     String?
  profileImage String?
  resetToken   String?   @unique

  assignedLeads Lead[] @relation("VendorLeads")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt // This attribute tells Prisma to manage this field automatically
}

model Lead {
  id           String   @id @default(cuid())
  productType  ProductType
  name         String?
  email        String?
  phone        String?
  otpVerified  Boolean  @default(false)

  customFields Json @default("{}")
  
  source       String?

  pipelineStage PipelineStage @default(New_Lead)
  score         Int           @default(30)
  scoreStatus   LeadScoreStatus @default(Cold)

  assignedTo        User?     @relation("VendorLeads", fields: [assignedVendorId], references: [id])
  assignedVendorId  String?

  documents   Document[]
  activityLog Activity[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt // This attribute tells Prisma to manage this field automatically
}

model Document {
  id        String   @id @default(cuid())
  filename  String
  lead      Lead     @relation(fields: [leadId], references: [id])
  leadId    String
  uploadedAt DateTime @default(now())
}

model Activity {
  id        String   @id @default(cuid())
  action    String
  user      String?
  notes     String?
  lead      Lead     @relation(fields: [leadId], references: [id])
  leadId    String
  timestamp DateTime @default(now())
}

model Setting {
  id    String @id @default(cuid()) // Added a default value generator
  key   String @unique
  value String
}